<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: widgets.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: widgets.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/*
Copyright 2012 MarkLogic Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/


com = window.com || {};
com.marklogic = window.com.marklogic || {};
com.marklogic.widgets = window.com.marklogic.widgets || {};





// generic useful functions (not namespaced)

function bubbleSort(a,jsonPath,reversed)
{
    var swapped;
    do {
        swapped = false;
        for (var i=0; i &lt; a.length-1; i++) {
	  var leftValue = 0;
	  var rightValue = 0;
	  if (typeof a[i] == "object" && undefined != jsonPath) {
	    leftValue = jsonExtractValue(a[i],jsonPath);
	  } else {
	    leftValue = a[i];
	  }
	  if (typeof a[i+1] == "object" && undefined != jsonPath) {
	    rightValue = jsonExtractValue(a[i+1],jsonPath);
	  } else {
	    rightValue = a[i+1];
	  }
	  if (undefined != reversed && reversed == true) {
	    // reverse the order of sort
	    var t = leftValue;
	    leftValue = rightValue;
	    rightValue = t;
	    t = undefined;
	  }
            if (leftValue &lt; rightValue) {
                var temp = a[i];
                a[i] = a[i+1];
                a[i+1] = temp;
                swapped = true;
            }
        }
    } while (swapped);
}




function msort(array, begin, end, comparisonValue)
{
	var size=end-begin;
	if(size&lt;2) return;

	var begin_right=begin+Math.floor(size/2);

	msort(array, begin, begin_right, comparisonValue);
	msort(array, begin_right, end, comparisonValue);
	//merge_inplace(array, begin, begin_right, end, comparisonValue);
	array = merge_sort(array,function(left,right) {
	  var leftValue = 0;
	  var rightValue = 0;
	  if (typeof left == "object" && undefined != comparisonValue) {
	    leftValue = jsonExtractValue(left,comparisonValue);
	  } else {
	    leftValue = left;
	  }
	  if (typeof right == "object" && undefined != comparisonValue) {
	    rightValue = jsonExtractValue(right,comparisonValue);
	  } else {
	    rightValue = right;
	  }
	  leftValue = 1 * leftValue;
	  rightValue = 1 * rightValue; // numeric conversion - read from JSON as string TODO check for errors (e.g. actually a string)
    console.log("msort_inline_function-sort(): left value: " + leftValue + ", rightValue: " + rightValue);
	  if (leftValue == rightValue) {
	    console.log("returning 0");
	    return 0;
	  } else {
	    if (leftValue &lt; rightValue) {
	      console.log("returning -1");
	      return -1;
	    } else if (rightValue &lt; leftValue ){
	      console.log("returning 1");
	      return 1;
	    } else {
	      console.log("Typeof leftValue: " + (typeof leftValue));
	      console.log("Typeof rightValue: " + (typeof rightValue));
	      return -2;
	    }
	  }
	});
}

function merge_sort_inplace(array,comparison)
{
	msort(array, 0, array.length,comparison);
}

function merge_inplace(array, begin, begin_right, end, comparisonValue)
{
  console.log("merge_inplace(): array: " + JSON.stringify({array: array}));
  var leftValue, rightValue;
	for(;begin &lt; begin_right; ++begin) {
	  leftValue = 0;
	  rightValue = 0;
	  if (typeof array[begin] == "object" && undefined != comparisonValue) {
	    leftValue = jsonExtractValue(array[begin],comparisonValue);
	  } else {
	    leftValue = array[begin];
	  }
	  if (typeof array[begin_right] == "object" && undefined != comparisonValue) {
	    rightValue = jsonExtractValue(array[begin_right],comparisonValue);
	  } else {
	    rightValue = array[begin_right];
	  }
    console.log("merge_inplace(): left value: " + leftValue + ", rightValue: " + rightValue);
	  
		if(leftValue &lt; rightValue) {
			var v=array[begin];
			array[begin]=array[begin_right];
			insert(array, begin_right, end, v);
		}
	}
  console.log("merge_inplace(): array NOW: " + JSON.stringify({array: array}));
}

function merge_sort(array,comparison)
{
	if(array.length &lt; 2)
		return array;
	var middle = Math.ceil(array.length/2);
	return merge(merge_sort(array.slice(0,middle),comparison),
			merge_sort(array.slice(middle),comparison),
			comparison);
}

function merge(left,right,comparison)
{
	var result = new Array();
	while((left.length > 0) && (right.length > 0))
	{
		if(comparison(left[0],right[0]) &lt;= 0)
			result.push(left.shift());
		else
			result.push(right.shift());
	}
	while(left.length > 0)
		result.push(left.shift());
	while(right.length > 0)
		result.push(right.shift());
	return result;
}

function insert(array, begin, end, v)
{
	while(begin+1&lt;end && array[begin+1]&lt;v) {
		array.swap(begin, begin+1);
		++begin;
	}
	array[begin]=v;
}


function jsonExtractValue(json,namePath) {
  var paths = namePath.split(".");
  var obj = json;
  for (var i = 0;undefined != obj && i &lt; paths.length;i++) {
    obj = obj[paths[i]]; // TODO handle documents with multiple result container elements (arrays of results within same doc)
  }
  //mljs.defaultconnection.logger.debug("jsonExtractValue(): Returning value: " + obj);
  return obj;
};

function xmlExtractValue(xmldoc,namePath) {
  // construct and apply XPath from namePath
  var xpath = "/" + namePath.replace(/\./g,"/");
  
  // TODO apply xpath to extract document value
  return 0;
};

function extractValue(jsonOrXml,namePath) {
  if ('object' == typeof(jsonOrXml) && undefined == jsonOrXml.nodeType) {
    return jsonExtractValue(jsonOrXml,namePath);
  } else if ('string' == typeof(jsonOrXml)) {
    return xmlExtractValue(textToXML(jsonOrXml),namePath);
  } else if (undefined == jsonOrXml) {
    return null;
  } else {
    return xmlExtractValue(jsonOrXml,namePath);
  }
};

function jsonOrXml(jsonOrXmlOrString) {
  if ('object' == typeof(jsonOrXmlOrString) && undefined == jsonOrXml.nodeType) {
    return jsonOrXmlOrString;
  } else if ('string' == typeof(jsonOrXmlOrString)) {
    if (jsonOrXmlOrString.substring(0,1) == "{") {
      return JSON.parse(jsonOrXmlOrString);
    } else { 
      return textToXML(jsonOrXmlOrString);
    }
  } else if (undefined == jsonOrXmlOrString) {
    return null;
  } else {
    return jsonOrXmlOrString;
  }
};

// EXTRA ARRAY FUNCTIONS

if (undefined == Array.prototype.swap) {
  Array.prototype.swap=function(a, b)
  {
	  var tmp=this[a];
	  this[a]=this[b];
	  this[b]=tmp;
  };
}

// TODO remove the below and replace with sensible default / check
if (undefined == Array.prototype.contains) {
  Array.prototype.contains = function(obj) {
    var i = this.length;
    while (i--) {
      if (this[i] === obj) {
        return true;
      }
    }
    return false;
  };
}

Array.prototype.position = function(value) {
  for (var i = 0;i &lt; this.length;i++) {
    if (this[i] == value) {
      return i;
    }
  }
  return -1;
};

// Following is required on Safari on the Mac (required by charts result parsing)
if (undefined == String.prototype.startsWith) {
  String.prototype.startsWith = function(str) {
    if (undefined == this || this.length == 0) return false;
    return (this.substring(0,str.length) == str);
  };
}




com.marklogic.widgets.hide = function(el,isHidden) {
  if (isHidden) {
    com.marklogic.widgets.addClass(el,"hidden");
  } else {
    com.marklogic.widgets.removeClass(el,"hidden");
  }
};

com.marklogic.widgets.addClass = function(el,classname) {
    var found = false;
    var attr = el.getAttribute("class");
    if (undefined != attr) {
      var attrs = attr.split(" ");
      for (var i = 0;!found && i &lt; attrs.length;i++) {
        found = (classname == attrs[i]);
      }
    }
    if (!found) {
      el.setAttribute("class",attr + " " + classname);
    }
};

com.marklogic.widgets.removeClass = function(el,classname) {
    var attr = el.getAttribute("class");
    var newClass = "";
    if (undefined != attr) {
      var attrs = attr.split(" ");
      for (var i = 0;i &lt; attrs.length;i++) {
        if (classname != attrs[i]) {
          newClass += attrs[i] + " ";
        }
      }
    }
    el.setAttribute("class",newClass);
};

// our own global widgets here
/**
 * An error display wrapper widget
 * 
 * @constructor
 */
com.marklogic.widgets.error = function(container) {
  this.container = container;
  
  this.error = null;
  
  this.allowDetails = false; // shows 'show details' button
  this.showFirstCodefile = false; // shows first file name,line number and column
  
  this._refresh();
};

com.marklogic.widgets.error.prototype.show = function(message) {
  this.error = message;
  this._refresh();
};

com.marklogic.widgets.error.prototype.updateError = com.marklogic.widgets.error.prototype.show;

com.marklogic.widgets.error.prototype.clear = function() {
  this.show(null);
};

/**
 * Detect Javascript built in errors - https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error
 * For available properties also see - https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error/prototype
 * @private
 */
com.marklogic.widgets.error.prototype._isJSError = function() {
  //console.log("_isJSError: typeof: " + typeof this.error);
  //console.log("_isJSError: content: " + JSON.stringify(this.error));
  if (null == this.error) { return false; }
  
  var jserr = false;
  this.jserrortype = null;
  if (this.error instanceof EvalError) {
    jserr = true;
    this.jserrortype = "EvalError";
  } else if (this.error instanceof RangeError) {
    jserr = true;
    this.jserrortype = "RangeError";
  } else if (this.error instanceof ReferenceError) {
    jserr = true;
    this.jserrortype = "ReferenceError";
  } else if (this.error instanceof SyntaxError) {
    jserr = true;
    this.jserrortype = "SyntaxError";
  } else if (this.error instanceof TypeError) {
    jserr = true;
    this.jserrortype = "TypeError";
  } else if (this.error instanceof URIError) {
    jserr = true;
    this.jserrortype = "URIError";
  } else if (this.error instanceof Error) {
    jserr = true;
    this.jserrortype = "Error";
    // generic handler
  } else if (typeof this.error == "object" && undefined != this.error.fileName) {
    jserr = true;
    this.jserrortype = "JSONError";
  }
  return jserr;
};

com.marklogic.widgets.error.prototype._refresh = function() {
  //if (null == this.error || undefined == this.error) { return; }
  
  if (this._isJSError()) {
    // gen JS html error message
    this._genjshtml();
  } else
  if (null != this.error && "object" == typeof this.error) {
    // check if a result object or a error frame set, or an XML document
    if (undefined != this.error.inError) { // an operation response from MLJS 
      // mljs results object
      if (this.error.inError) { // an operation response from MLJS that IS in error
        if (this.error.format == "json") {
          mljs.defaultconnection.logger.debug("Error object is result, and json");
          this._genhtml(this.error);
        } else {
          mljs.defaultconnection.logger.debug("Error object is result, and xml");
          mljs.defaultconnection.logger.debug("ERROR CURRENTLY: " + JSON.stringify(this.error));
          this._genhtml(xmlToJson(this.error.doc));
        }
        return true;
      } else {
        mljs.defaultconnection.logger.debug("Error object is result, and not in error");
        return false; // doing this allows you to do one if statement rather than if and call
      }
    } else {
      mljs.defaultconnection.logger.debug("Error document is not an mljs response document");
        if (undefined == this.error.nodeType) {
          mljs.defaultconnection.logger.debug("Error object is error doc, and json");
          this._genhtml(this.error);
        } else {
          mljs.defaultconnection.logger.debug("Error object is error doc, and xml");
          this._genhtml(xmlToJson(this.error.doc));
        }
      //this._genhtml(this.error);
    }
    // display pretty print JSON error
  } else { // not an object - string? or null (blank)
    mljs.defaultconnection.logger.debug("Error object is simple string");
    // assume string
    if (null != this.error && undefined != this.error) {
      var str = "&lt;div class='error-inner' id='" + this.container + "-error-inner'>&lt;div class='error-message'>" + this.error + "&lt;/div>";
      str += "&lt;/div>";
      var el = document.getElementById(this.container);
      el.innerHTML = str;
    } else {
      document.getElementById(this.container).innerHTML = ""; // blank error
    }
  }
};

com.marklogic.widgets.error.prototype._genjshtml = function() {
  mljs.defaultconnection.logger.debug("_genjshtml");
  var e = this.error;
  var t = this.jserrortype;
  mljs.defaultconnection.logger.debug("_genjshtml: error type: " + t);
  
  // Standard fields: message, name
  // MS fields: description, number
  // Firefox fields: fileName, lineNumber, columnName, stack (object)
  
  var str = "&lt;div class='error-inner' id='" + this.container + "-error-inner'>";
  // do header
  str += "&lt;div class='error-title'>" + e.name + ": " + e.message + "&lt;/div>";
  
  mljs.defaultconnection.logger.debug("_genjshtml: e info: " + e); 
  mljs.defaultconnection.logger.debug("_genjshtml: e info json: " + JSON.stringify(e)); 
  
  // further details, line num, etc
  if (this.showFirstCodefile) {
    // FIREFOX SPECIFIC
    if (undefined != e.lineNumber && undefined != e.fileName) {
      str += "&lt;div class='error-pointer'>";
      str += "&lt;p>Error occured at " + e.fileName + ":" + e.lineNumber + "&lt;/p>";
      str += "&lt;/div>";
    }
    // MICROSOFT SPECIFIC
    if (undefined != e.description && undefined != e.number) {
      str += "&lt;div class='error-pointer'>";
      str += "&lt;p>Error Number: " + e.number + ", Description: " + e.description + "&lt;/p>";
      str += "&lt;/div>";
    }
  }
  
  if (this.allowDetails && undefined != e.stack) {
    str += "&lt;div id='" + this.container + "-frame-details'>&lt;a class='error-show' id='" + this.container + "-frame-show' href='#'>Show Details&lt;/a>&lt;a class='hidden error-hide' id='" + this.container + "-frame-hide' href='#'>Hide Details&lt;/a>&lt;/div>&lt;div id='" + this.container + "-error-details-frames' class='hidden'>&lt;/div>";
  }
  
  str += "&lt;/div>";
  document.getElementById(this.container).innerHTML = str;
  var self = this;
  if (this.allowDetails) {
    document.getElementById(this.container + "-frame-show").onclick = function(evt) {
      self._showJSDetails();
    };
  }
};

com.marklogic.widgets.error.prototype._showJSDetails = function() {
  var details = document.getElementById(this.container + "-error-details-frames");
  
  var e = this.error;
  
  var str = "";
  //str += "&lt;div>Stack info: " + JSON.stringify(e.stack) + "&lt;/div>";
  //for (var i = 0;i &lt; e.stack.length;i++) {
  //  str += e.stack[i] + "&lt;br/>";
  //}
  str = e.stack.replace(/$/mg,"&lt;br/>");
  
  details.innerHTML = str;
  
  console.log("setting details class");
  details.setAttribute("class","error-details-frames");
  
  console.log("setting show to invisible")
  var show = document.getElementById(this.container + "-frame-show");
  show.setAttribute("class","error-show hidden");
  console.log("setting hide to visible");
  var hide = document.getElementById(this.container + "-frame-hide");
  hide.setAttribute("class","error-hide");
  var self = this;
  document.getElementById(this.container + "-frame-hide").onclick = function(evt) {
    console.log("hide clicked");
    self._hideDetails(); // same hide function as normal details box
    console.log("hide clicked complete");
  };
  
};

/**
 * Generates a HTML summary of a MarkLogic error XML document. Error object must have been converted to JSON using xmlToJson()
 * @private
 */
com.marklogic.widgets.error.prototype._genhtml = function(obj) {
  mljs.defaultconnection.logger.debug("_genhtml: Called with: " + JSON.stringify(obj));
  
  var str = "&lt;div class='error-inner' id='" + this.container + "-error-inner'>";
  // do header
  str += "&lt;div class='error-title'>" + obj.error["format-string"] + "&lt;/div>";
  // further details, line num, etc
  if (this.showFirstCodefile) {
    if (undefined != obj.error.stack.frame[0]) {
      var frame = obj.error.stack.frame[0];
      str += "&lt;div class='error-pointer'>" + frame.uri + ":" + frame.line + " column " + frame.column + " - operation " + frame.operation + "&lt;/div>";
    }
  }
  // then provide link for more details (if allowDetails is true)
  if (this.allowDetails) {
    str += "&lt;div id='" + this.container + "-frame-details'>&lt;a class='error-show' id='" + this.container + "-frame-show' href='#'>Show Details&lt;/a>&lt;a class='hidden error-hide' id='" + this.container + "-frame-hide' href='#'>Hide Details&lt;/a>&lt;/div>";
  }
  str += "&lt;/div>";
  document.getElementById(this.container).innerHTML = str;
  var self = this;
  if (this.allowDetails) {
    document.getElementById(this.container + "-frame-show").onclick = function(evt) {
      self._showDetails();
    };
  }
};

/**
 * Display MarkLogic server error frame details
 * @private
 */
com.marklogic.widgets.error.prototype._showDetails = function() {
  var details = document.getElementById(this.container + "-error-details-frames");
  if (undefined == details) {
    // generate HTML
    var str = "&lt;div id='" + this.container + "-error-details-frames'>";
    // NB error.error may not exist - response could be plain text
    if (undefined == this.error.error) {
      // plain text
      str += "Error details are plain text. No frames exist. Full details below:-&lt;br/>" + this.error.doc;
    } else {
      for (var f = 0;f &lt; this.error.error.error.stack.frame.length;f++) {
        var frame = this.error.error.error.stack.frame[f];
        str += "&lt;div class='error-frame'>";
        
        // show frame details
        str += frame.uri + ":" + frame.line + "." + frame.column;
        if (undefined != frame.operation) {
          str += " " + frame.operation; 
        }
        
        str += "&lt;/div>";
      }
    }
    str += "&lt;/div>";
    var parent = document.getElementById(this.container + "-frame-details");
    parent.innerHTML = parent.innerHTML + str; // TODO REPLACE THIS AS BAD PRACTICE
    
    details = document.getElementById(this.container + "-error-details-frames");
  }
  console.log("setting details class");
  details.setAttribute("class","error-details-frames");
  
  console.log("setting show to invisible")
  var show = document.getElementById(this.container + "-frame-show");
  show.setAttribute("class","error-show hidden");
  console.log("setting hide to visible");
  var hide = document.getElementById(this.container + "-frame-hide");
  hide.setAttribute("class","error-hide");
  var self = this;
  document.getElementById(this.container + "-frame-hide").onclick = function(evt) {
    console.log("hide clicked");
    self._hideDetails();
    console.log("hide clicked complete");
  };
};

/**
 * Hide MarkLogic error frame details
 * @private
 */
com.marklogic.widgets.error.prototype._hideDetails = function() {
  var details = document.getElementById(this.container + "-error-details-frames");
  details.setAttribute("class","error-details-frames hidden");
  
  var show = document.getElementById(this.container + "-frame-show");
  show.setAttribute("class","error-show");
  var hide = document.getElementById(this.container + "-frame-hide");
  hide.setAttribute("class","error-hide hidden");
  var self = this;
  document.getElementById(this.container + "-frame-show").onclick = function(evt) {
    self._showDetails();
  };
};









/**
 *  Static functions that provide other widgets with useful, consistent elements.
 *
 * @namespace
 */
com.marklogic.widgets.bits = {
  _base: "/images"
};

com.marklogic.widgets.bits.base = function(newbase) {
  com.marklogic.widgets.bits._base = newbase;
}

/**
 * Creates a loading message or image
 * 
 * @param {string} elid - The element for this widget's top level container
 */
com.marklogic.widgets.bits.loading = function(elid) {
  var s = "&lt;img id='" + elid + "' class='bits-loading' src='" + com.marklogic.widgets.bits._base + "/mljs/loading.gif' style='width: 30px; height: 30px;' alt='Loading...' title='Loading...' />";
  
  return s;
};

/**
 * Creates a failure message or image
 * 
 * @param {string} elid - The element for this widget's top level container
 */
com.marklogic.widgets.bits.failure = function(elid) {
  var s = "&lt;img id='" + elid + "' class='bits-failure' src='" + com.marklogic.widgets.bits._base + "/mljs/failure.png' alt='Failed to complete operation' title='Failed to complete operation' /> Failed to complete operation";
  
  return s;
};

/**
 * Creates a complete message
 * 
 * @param {string} elid - The element for this widget's top level container
 */
com.marklogic.widgets.bits.done = function(elid,message_opt) {
  var s = "&lt;span id='" + elid + "' class='bits-done'>";
  if (undefined == message_opt) {
    s += "Done.";
  } else {
    s += message_opt;
  }
  s += "&lt;/span>";
  return s;
};

/**
 * Appends HTML safely to a DOM node. Avoids using innerHTML += which redraws ALL innerHTML content
 * @param {DOMElement} el - The element to append the HTML to
 * @param {string} s - The HTML String of the HTML to append to the element
 */
com.marklogic.widgets.appendHTML = function(el,s) {
  var newcontent = document.createElement('div');
  newcontent.innerHTML = s;
  
  while (newcontent.firstChild) {
    el.appendChild(newcontent.firstChild);
  }
};







/**
 * DRAG AND DROP GENERIC SUPPORT HELPER FUNCTIONS
 * See http://stackoverflow.com/questions/15775440/javascript-drag-drop-a-div-on-a-web-page?lq=1
 * and http://www.w3schools.com/html/html5_draganddrop.asp#gsc.tab=0
 */
com.marklogic.widgets.dnd = {
  droppables: {}, // droppables["elid"] = {classname: "myclass", accept: [class1,class2,...] }
  draggables: {} // draggables["elid"] = {classname: "myclass", onto: [class1,...] }
};

com.marklogic.widgets.dnd.accept = function(elid,droppableClass,draggableTypeArrayToAccept,actionCallback) {
  // assume caller does html generation (for speed)
  // add droppable configuration
  var droppable = {classname: droppableClass,accept: draggableTypeArrayToAccept, action: actionCallback};
  com.marklogic.widgets.dnd.droppables[elid] = droppable;
  // add event handlers
  var el = document.getElementById(elid);
  mljs.defaultconnection.logger.debug("dnd.onto: adding event handlers to: " + elid);
  el.addEventListener("dragover",function(ev) {
    mljs.defaultconnection.logger.debug("dnd.onto: ondragover: " + elid);
    //var match = com.marklogic.widgets.dnd._compatible(el,elid,droppable); // TODO find and pass draggable elid
    //if (match) {
      // TODO add dnd hover class to element
    //}
    ev.preventDefault();
    mljs.defaultconnection.logger.debug("dnd.accept: ondragover: returning false");
    return false;
  });
  // TODO on drag out?
  el.addEventListener("drop",function(ev) {
    mljs.defaultconnection.logger.debug("dnd.onto: ondrop: " + elid);
    //var match = com.marklogic.widgets.dnd._compatible(el,elid,droppable); // TODO find and pass draggable elid
    //if (match) {
      var data = JDON.parse(ev.dataTransfer.getData("application/javascript"));
    mljs.defaultconnection.logger.debug("dnd.accept: ondrop: calling action callback");
      droppable.action(data);
    //}
    ev.preventDefault();
    mljs.defaultconnection.logger.debug("dnd.accept: ondrop: returning false");
    return false;
  });
  mljs.defaultconnection.logger.debug("dnd.onto: completed adding event handlers to: " + elid);
};

com.marklogic.widgets.dnd.onto = function(elid,draggableClass,droppableTypeArrayToMap,dataOrCallback) {
  // assume caller does html generation (for speed) (For HTML5 this element MUST have attribute draggable="true")
  // add draggable configuration
  var draggable = {classname: draggableClass, onto: droppableTypeArrayToMap, dataOrCallback: dataOrCallback};
  com.marklogic.widgets.dnd.draggables[elid] = draggable;
  // add event handlers
  var el = document.getElementById(elid);
  el.ondragstart = function(ev) {
    mljs.defaultconnection.logger.debug("dnd.onto: ondragstart: " + elid);
    //var match = com.marklogic.widgets.dnd._draggableCompatible(el,elid,draggable); // TODO get elid of droppable and pass that too
    //if (match) {
      // send data
      var data = {};
      if ("function" === typeof(dataOrCallback)) {
        data = dataOrCallback();
      } else {
        data = dataOrCallback;
      }
      mljs.defaultconnection.logger.debug("dnd.onto: ondragstart: sending data");
      var sd = JSON.stringify(data);
      ev.dataTransfer.setData("application/javascript",sd);
      mljs.defaultconnection.logger.debug("dnd.onto: ondragstart: sent data: " + sd);
    //}
    ev.preventDefault();
    mljs.defaultconnection.logger.debug("dnd.onto: ondragstart: returning false");
    return false;
  };
};

com.marklogic.widgets.dnd._compatible = function(el,elid,droppable,draggableElid) {
  // check if the droppable matches the draggable being hovered over the top
  var dragClass = com.marklogic.widgets.dnd.draggables[draggableElid];
  if (null == dragClass || undefined == dragClass) {
    return false; // can't match if not in one of our lists
  }
  for (var i = 0, max = droppable.accept.length,dropClass;i &lt; max;i++) {
    dropClass = droppable.accept[i];
    if (dragClass == dropClass || "*" == dropClass) {
      return true;
    }
  }
  return false;
};

com.marklogic.widgets.dnd._draggableCompatible = function(el,elid,draggable,droppableElid) {
  // check that this
  var dropClass = com.marklogic.widgets.dnd.droppables[droppableElid];
  if (null == dropClass || undefined == dropClass) {
    return false; // can't match if not in one of our lists
  }
  for (var i = 0, max = draggable.onto.length,dragClass;i &lt; max;i++) {
    dragClass = draggable.onto[i];
    if (dragClass == dropClass || "*" == dragClass) {
      return true;
    }
  }
  return false;
};

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="com.marklogic.widgets.collectionuris.html">collectionuris</a></li><li><a href="com.marklogic.widgets.cooccurence.html">cooccurence</a></li><li><a href="com.marklogic.widgets.create.html">create</a></li><li><a href="com.marklogic.widgets.docviewer.html">docviewer</a></li><li><a href="com.marklogic.widgets.entityfacts.html">entityfacts</a></li><li><a href="com.marklogic.widgets.error.html">error</a></li><li><a href="com.marklogic.widgets.graphexplorer.html">graphexplorer</a></li><li><a href="com.marklogic.widgets.highcharts.html">highcharts</a></li><li><a href="com.marklogic.widgets.kratu.html">kratu</a></li><li><a href="com.marklogic.widgets.markings.html">markings</a></li><li><a href="com.marklogic.widgets.openlayers.html">openlayers</a></li><li><a href="com.marklogic.widgets.profile.html">profile</a></li><li><a href="com.marklogic.widgets.rdb2rdf.html">rdb2rdf</a></li><li><a href="com.marklogic.widgets.searchbar.html">searchbar</a></li><li><a href="com.marklogic.widgets.searchpage.html">searchpage</a></li><li><a href="com.marklogic.widgets.searchpager.html">searchpager</a></li><li><a href="com.marklogic.widgets.searchresults.html">searchresults</a></li><li><a href="com.marklogic.widgets.searchselection.html">searchselection</a></li><li><a href="com.marklogic.widgets.searchsort.html">searchsort</a></li><li><a href="com.marklogic.widgets.selection.html">selection</a></li><li><a href="com.marklogic.widgets.sparqlbar.html">sparqlbar</a></li><li><a href="com.marklogic.widgets.sparqlresults.html">sparqlresults</a></li><li><a href="com.marklogic.widgets.workplace.html">workplace</a></li></ul><h3>Namespaces</h3><ul><li><a href="com.marklogic.widgets.bits.html">bits</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-001-intro.html">001-intro</a></li><li><a href="tutorial-001-widgets-list.html">001-widgets-list</a></li><li><a href="tutorial-002-intro-firstpage.html">002-intro-firstpage</a></li><li><a href="tutorial-002-widgets-search.html">002-widgets-search</a></li><li><a href="tutorial-003-widgets-search-render.html">003-widgets-search-render</a></li><li><a href="tutorial-004-widgets-highcharts.html">004-widgets-highcharts</a></li><li><a href="tutorial-011-browser-create-app.html">011-browser-create-app</a></li><li><a href="tutorial-012-browser-install-app.html">012-browser-install-app</a></li><li><a href="tutorial-013-browser-samples-app.html">013-browser-samples-app</a></li><li><a href="tutorial-014-browser-workplace.html">014-browser-workplace</a></li><li><a href="tutorial-050-core-contexts.html">050-core-contexts</a></li><li><a href="tutorial-901-ontology.html">901-ontology</a></li><li><a href="tutorial-999-samples.html">999-samples</a></li><li><a href="tutorial-all.html">all</a></li></ul><h3>Global</h3><ul><li><a href="global.html#com">com</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Fri Dec 13 2013 14:18:44 GMT-0000 (GMT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
