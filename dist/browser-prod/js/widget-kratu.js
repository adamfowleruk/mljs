
com=window.com||{};com.marklogic=window.com.marklogic||{};com.marklogic.widgets=window.com.marklogic.widgets||{};com.marklogic.widgets.kratu=function(container){this.container=container;this.errorPublisher=new com.marklogic.events.Publisher();this.results=null;this.facts=null;this.kratu=new Kratu();document.getElementById(container).innerHTML="<div id='"+container+"-inner' class='mljswidget'></div>"
this.kratu.setRenderElement(document.getElementById(this.container+"-inner"));this._render="content";this._refresh();};com.marklogic.widgets.kratu.prototype.render=function(render){this._render=render;};com.marklogic.widgets.kratu.prototype.updateResults=function(results){mljs.defaultconnection.logger.debug("kratu.updateResults called");if(typeof(results)!="boolean"&&undefined!=results&&null!=results){mljs.defaultconnection.logger.debug("kratu.updateResults: Got real results");this.results=results;if("content"==this._render){mljs.defaultconnection.logger.debug("kratu.updateResults: Rendering search result contents");var content=new Array();for(var i=0,r;i<this.results.results.length;i++){r=this.results.results[i];mljs.defaultconnection.logger.debug("kratu.updateResults: Parsing result "+i+"="+r.content);if(typeof(r.content)=="string"){content.push(JSON.parse(this.results.results[i].content));}else if(typeof(r.content)=="object"){if(undefined!=r.content.nodeType){}else{content.push(r.content);}}}
this.kratu.setEntities(content);}else{mljs.defaultconnection.logger.debug("kratu.updateResults: Rendering search result statistics");this.kratu.setEntities(this.results.results);}
this._refresh();}};com.marklogic.widgets.kratu.prototype.updateFacts=function(facts){this.facts=facts;var rows=new Array();for(var r=0,max=facts.results.bindings.length;r<max;r++){var result=facts.results.bindings[r];var res={};for(var b=0,maxb=facts.head.vars.length;b<maxb;b++){var varname=facts.head.vars[b];res[varname]=result[varname].value;}
rows.push(res);}
this.kratu.setEntities(rows);this._refresh();};com.marklogic.widgets.kratu.prototype.addErrorListener=function(fl){this.errorPublisher.subscribe(fl);};com.marklogic.widgets.kratu.prototype.removeErrorListener=function(fl){this.errorPublisher.unsubscribe(fl);};com.marklogic.widgets.kratu.prototype._refresh=function(){if((null==this.results||undefined==this.results||"boolean"==typeof this.results)&&(null==this.facts||undefined==this.facts||"boolean"==typeof this.facts)){return;}
this.kratu.renderReport();};